$(function(){new xsSearchBook().Init();$("[jq=BookList]").find("[jq=BookManaging]").each(function(){var a=$(this);var b=$(this).attr("BookId");var c=$(this).find("[jq=BookCheckButton]");c.click(function(){if($("#hidetime"+b).val()){var e=$("#hidetime"+b).datetimepicker("getDate").getTime()/1000}var f=$("#VIP"+b).prop("checked");$.ajax({url:"/BookCheckTrue",type:"POST",data:({BookId:b,HideTime:e,VIP:f}),success:function(g){var h=xsJsonParse(g);c.remove()}})});var d=$(this).find("[jq=DeleteBook]");d.click(function(){$("<div />",{html:'Если вы желаете, чтобы книга больше не появлялась в открытом доступе, то лучше нажмите "Закрыть доступ", иначе книгу запросто смогу добавить еще раз.'}).dialog({resizable:false,modal:true,title:"",width:300,buttons:[{"class":"deletebutton",text:"Удалить",click:function(){var e=$(this);$.ajax({url:"/BookSecretHide",data:{BookId:b},success:function(f){var g=xsJsonParse(f);xsMessage("К книге закрыт доступ <br />"+g.Content,"");e.dialog("close")}})}},{"class":"hidebutton",text:"Закрыть доступ",click:function(){var e=$(this);$.ajax({url:"/BookDeleteHide",data:{BookId:b},success:function(f){var g=xsJsonParse(f);xsMessage("Книга удалена <br />"+g.Content,"");e.dialog("close")}})}},{"class":"cancelbutton",text:"Нет",click:function(){$(this).dialog("close")}}]});$(".deletebutton").focus()})})});function xsSearchBook(){var a=false;this.Init=function(c){var b=this;$("[jq=SelectGenresDialogOpen]").click(function(){if(!a){a=$("<div />",{html:""});a.dialog({width:960,position:{my:"center top+100",at:"top",of:window},modal:true,resizable:true,title:"Выбор жанров",create:function(d,e){a.html("Загрузка...");$.ajax({url:"/SearchBookSelectGenre",type:"POST",success:function(f){var g=xsJsonParse(f);a.html(g.Content);b.OnShowSelectGenreDialog()}})},open:function(){}})}else{if(!a.dialog("isOpen")){a.dialog("open")}}});new xsExcludeGenre().Init()},this.OnShow=function(){var b=this},this.OnShowSelectGenreDialog=function(){var b=this;var c=explode_comma($("[jq=SelectedGenresIds]").val());if((c.length)&&(c[0]>0)){a.find("[jq=SubGenre]").each(function(){var d=$(this);var e=$(this).attr("SubgenreId");var f=false;$.each(c,function(g,h){if(e==h){f=true}});if(f){d.prop("checked",true)}else{d.prop("checked",false)}})}a.find("[jq=Genre]").each(function(){var e=$(this);var d=$(this).find("[jq=SelectGenre]");if(e.find("[SubgenreId]:not(:checked)").exists()){d.prop("checked",false)}else{d.prop("checked",true)}});a.find("[jq=SelectAllGenre]").click(function(){a.find("[jq=Genres]").find("input[type=checkbox]").prop("checked",true);b.UpdateGenreCount()});a.find("[jq=RemoveAllGenre]").click(function(){a.find("[jq=Genres]").find("input[type=checkbox]:checked").prop("checked",false);b.UpdateGenreCount()});a.find("[jq=Genre]").each(function(){var d=$(this);d.find("[jq=SelectGenre]").click(function(){if($(this).prop("checked")){d.find("input[type=checkbox]:not(:checked)").prop("checked",true)}else{d.find("input[type=checkbox]:checked").prop("checked",false)}b.UpdateGenreCount()})});a.find("input[type=checkbox]").click(function(){b.UpdateGenreCount()})},this.UpdateGenreCount=function(){var c=a.find("[jq=SubGenre]:checked").size();$("[jq=SelectedGenreCount]").html(c);var b=Array();a.find("[jq=SubGenre]:checked").each(function(){b.push($(this).attr("SubgenreId"))});$("[jq=SelectedGenresIds]").val(implode_comma(b))}}function xsExcludeGenre(){var a=false;this.Init=function(c){var b=this;$("[jq=ExcludeGenresDialogOpen]").click(function(){if(!a){a=$("<div />",{html:""});a.dialog({width:960,position:{my:"center top+10",at:"top",of:window},modal:true,resizable:true,title:"Какие жанры исключить из поиска",create:function(d,e){a.html("Загрузка...");$.ajax({url:"/SearchBookExcludeGenre",type:"POST",success:function(f){var g=xsJsonParse(f);a.html(g.Content);b.OnShowSelectGenreDialog()}})},open:function(){}})}else{if(!a.dialog("isOpen")){a.dialog("open")}}})},this.OnShowSelectGenreDialog=function(){var b=this;var c=explode_comma($("[jq=ExcludeGenresIds]").val());a.find("[jq=SubGenre]").each(function(){var d=$(this);var e=$(this).attr("SubgenreId");var f=false;$.each(c,function(g,h){if(e==h){f=true}});if(f){d.prop("checked",true)}else{d.prop("checked",false)}});a.find("[jq=Genre]").each(function(){var e=$(this);var d=$(this).find("[jq=SelectGenre]");if(e.find("[SubgenreId]:not(:checked)").exists()){d.prop("checked",false)}else{d.prop("checked",true)}});a.find("[jq=RemoveAllGenre]").click(function(){a.find("[jq=Genres]").find("input[type=checkbox]:checked").prop("checked",false);b.UpdateGenreCount()});a.find("[jq=Genre]").each(function(){var d=$(this);d.find("[jq=SelectGenre]").click(function(){if($(this).prop("checked")){d.find("input[type=checkbox]:not(:checked)").prop("checked",true)}else{d.find("input[type=checkbox]:checked").prop("checked",false)}b.UpdateGenreCount()})});a.find("input[type=checkbox]").click(function(){b.UpdateGenreCount()})},this.UpdateGenreCount=function(){var c=a.find("[jq=SubGenre]:checked").size();$("[jq=ExcludeGenreCount]").html(c);var b=Array();a.find("[jq=SubGenre]:checked").each(function(){b.push($(this).attr("SubgenreId"))});$("[jq=ExcludeGenresIds]").val(implode_comma(b))}};